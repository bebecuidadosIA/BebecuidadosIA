<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beb√©Food IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f1f5f9; margin: 0; }
        .app-container { max-width: 450px; margin: 0 auto; min-height: 100vh; background: white; display: flex; flex-direction: column; position: relative; }
        .tab-content { flex: 1; overflow-y: auto; padding-bottom: 80px; }
        .nav-button { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 12px; gap: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Configura√ß√£o Supabase
        const SUPABASE_URL = "https://zvdoakrgrgvnhmwlqgnr.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2ZG9ha3Jncmd2bmhtd2xxZ25yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0NDEwMjksImV4cCI6MjA4NjAxNzAyOX0.-wkOsgmKKO0AH2Jo4GHyQcWkJDJwyeAPn_3kb3_4AsI";
        const GEMINI_KEY = "AIzaSyCU_3CjkJXn8TwpPB7TTkvhrkGZQ0wIAmg";

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function App() {
            const [session, setSession] = useState(null);
            const [view, setView] = useState('welcome'); // welcome, login, signup, quiz, main
            const [tab, setTab] = useState('home'); // home, chat, cardapio, receitas
            const [bebe, setBebe] = useState({ nome: '', idade: '' });
            const [loading, setLoading] = useState(false);
            const [chat, setChat] = useState([{ role: 'bot', text: 'Ol√° mam√£! Como posso ajudar hoje? üë∂' }]);
            const [input, setInput] = useState('');

            // Verificar Login
            useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    if (session) {
                        setSession(session);
                        setView('main');
                    }
                });
            }, []);

            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: e.target.email.value,
                    password: e.target.password.value
                });
                if (error) alert("Erro: " + error.message);
                else { setSession(data.session); setView('main'); }
                setLoading(false);
            };

            const handleSignup = async (e) => {
                e.preventDefault();
                setLoading(true);
                const { data, error } = await supabase.auth.signUp({
                    email: e.target.email.value,
                    password: e.target.password.value
                });
                if (error) alert("Erro: " + error.message);
                else setView('quiz');
                setLoading(false);
            };

            const askJeey = async () => {
                if (!input.trim()) return;
                const userMsg = input;
                setChat([...chat, { role: 'user', text: userMsg }]);
                setInput('');
                setLoading(true);

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: userMsg }] }] })
                    });
                    const data = await res.json();
                    const reply = data.candidates[0].content.parts[0].text;
                    setChat(prev => [...prev, { role: 'bot', text: reply }]);
                } catch (e) {
                    setChat(prev => [...prev, { role: 'bot', text: 'Estou com um solu√ßo t√©cnico. Tente de novo! üòÖ' }]);
                }
                setLoading(false);
            };

            // TELAS INICIAIS
            if (view === 'welcome') return (
                <div className="app-container p-10 flex flex-col items-center justify-center bg-emerald-50">
                    <div className="text-7xl mb-8">üë∂</div>
                    <h1 className="text-4xl font-black text-emerald-900 mb-2">Beb√©Food IA</h1>
                    <p className="text-emerald-600 mb-12 text-center">Nutri√ß√£o com amor para o seu beb√©.</p>
                    <button onClick={() => setView('login')} className="w-full bg-emerald-500 text-white py-5 rounded-3xl font-bold mb-4 shadow-lg">Entrar</button>
                    <button onClick={() => setView('signup')} className="w-full bg-white text-emerald-500 py-5 rounded-3xl font-bold border border-emerald-200">Criar Conta</button>
                </div>
            );

            if (view === 'login' || view === 'signup') return (
                <div className="app-container p-8">
                    <button onClick={() => setView('welcome')} className="text-emerald-500 font-bold mb-10 italic">‚Üê Voltar</button>
                    <h2 className="text-3xl font-bold mb-8">{view === 'login' ? 'Bem-vinda!' : 'Nova Conta'}</h2>
                    <form onSubmit={view === 'login' ? handleLogin : handleSignup} className="space-y-4">
                        <input name="email" type="email" placeholder="E-mail" className="w-full p-5 bg-gray-50 border rounded-2xl outline-none" required />
                        <input name="password" type="password" placeholder="Palavra-passe" className="w-full p-5 bg-gray-50 border rounded-2xl outline-none" required />
                        <button type="submit" disabled={loading} className="w-full bg-emerald-500 text-white py-5 rounded-2xl font-bold shadow-lg">
                            {loading ? 'A carregar...' : 'Continuar'}
                        </button>
                    </form>
                </div>
            );

            if (view === 'quiz') return (
                <div className="app-container p-8 text-center">
                    <h2 className="text-2xl font-bold mb-6">Personalizar para o seu Beb√©</h2>
                    <input placeholder="Nome do Beb√©" className="w-full p-5 border rounded-2xl mb-4" onChange={e => setBebe({...bebe, nome: e.target.value})} />
                    <select className="w-full p-5 border rounded-2xl mb-8" onChange={e => setBebe({...bebe, idade: e.target.value})}>
                        <option>Qual a idade?</option>
                        <option>6 meses</option>
                        <option>7-9 meses</option>
                        <option>10-12 meses</option>
                    </select>
                    <button onClick={() => setView('main')} className="w-full bg-emerald-500 text-white py-5 rounded-2xl font-bold">Come√ßar Agora ‚ú®</button>
                </div>
            );

            // SISTEMA PRINCIPAL (DASHBOARD COM TABS)
            return (
                <div className="app-container">
                    <div className="tab-content">
                        {/* HEADER FIXO */}
                        <div className="p-6 bg-white border-b sticky top-0 flex justify-between items-center z-20">
                            <h1 className="font-bold text-emerald-600">Beb√©Food IA</h1>
                            <div className="text-[10px] bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full font-bold">PREMIUM</div>
                        </div>

                        {tab === 'home' && (
                            <div className="p-6 space-y-6">
                                <div className="bg-emerald-500 p-8 rounded-[2.5rem] text-white shadow-xl">
                                    <h3 className="font-bold text-xl mb-2">Ol√°, Mam√£! üëã</h3>
                                    <p className="text-sm opacity-90">Pronta para alimentar o {bebe.nome || 'seu beb√©'} com sa√∫de hoje?</p>
                                </div>
                                <div className="grid grid-cols-1 gap-4">
                                    <div className="bg-white p-6 border rounded-3xl flex items-center gap-4">
                                        <span className="text-3xl">üçè</span>
                                        <div><p className="font-bold text-sm">Fruta do Dia</p><p className="text-xs text-gray-400">Ma√ß√£ raspada</p></div>
                                    </div>
                                    <div className="bg-white p-6 border rounded-3xl flex items-center gap-4">
                                        <span className="text-3xl">üíß</span>
                                        <div><p className="font-bold text-sm">Hidrata√ß√£o</p><p className="text-xs text-gray-400">Ofere√ßa √°gua ap√≥s a papa</p></div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {tab === 'cardapio' && (
                            <div className="p-6 space-y-4">
                                <h3 className="font-bold text-xl mb-6">üìÖ Card√°pio da Semana</h3>
                                <div className="p-5 border rounded-3xl bg-white shadow-sm">
                                    <p className="font-bold text-emerald-600 mb-2">Segunda-feira</p>
                                    <p className="text-sm text-gray-600">‚Ä¢ Almo√ßo: Pur√© de Cenoura e Frango</p>
                                    <p className="text-sm text-gray-600">‚Ä¢ Jantar: Papa de Aveia</p>
                                </div>
                                <div className="p-5 border rounded-3xl bg-white shadow-sm">
                                    <p className="font-bold text-emerald-600 mb-2">Ter√ßa-feira</p>
                                    <p className="text-sm text-gray-600">‚Ä¢ Almo√ßo: Creme de Ab√≥bora</p>
                                    <p className="text-sm text-gray-600">‚Ä¢ Jantar: Leite Materno/F√≥rmula</p>
                                </div>
                            </div>
                        )}

                        {tab === 'receitas' && (
                            <div className="p-6 space-y-4">
                                <h3 className="font-bold text-xl mb-6">ü•ò Receitas F√°ceis</h3>
                                <div className="p-4 border rounded-2xl flex items-center gap-4 bg-white">
                                    <span className="text-2xl">ü•£</span>
                                    <p className="font-bold text-sm">Papa de Banana e Abacate</p>
                                </div>
                                <div className="p-4 border rounded-2xl flex items-center gap-4 bg-white">
                                    <span className="text-2xl">ü•ï</span>
                                    <p className="font-bold text-sm">Pur√© de Cenoura Baby</p>
                                </div>
                                <div className="p-4 border rounded-2xl flex items-center gap-4 bg-white">
                                    <span className="text-2xl">üçñ</span>
                                    <p className="font-bold text-sm">Caldinho de Vitela</p>
                                </div>
                            </div>
                        )}

                        {tab === 'chat' && (
                            <div className="flex flex-col h-[70vh] p-6">
                                <div className="flex-1 overflow-y-auto space-y-4 mb-4">
                                    {chat.map((m, i) => (
                                        <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                            <div className={`p-4 rounded-2xl max-w-[85%] text-sm ${m.role === 'user' ? 'bg-emerald-500 text-white' : 'bg-gray-100 text-gray-800'}`}>
                                                {m.text}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex gap-2">
                                    <input value={input} onChange={e => setInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && askJeey()} placeholder="Pergunte √† Jeey..." className="flex-1 p-4 bg-gray-50 border rounded-2xl outline-none" />
                                    <button onClick={askJeey} className="bg-emerald-500 text-white p-4 rounded-2xl">üöÄ</button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* MENU DE NAVEGA√á√ÉO INFERIOR - SEMPRE VIS√çVEL */}
                    <nav className="fixed bottom-0 left-0 right-0 max-w-[450px] mx-auto bg-white border-t flex justify-around p-2 z-30">
                        <button onClick={() => setTab('home')} className={`nav-button ${tab === 'home' ? 'text-emerald-500' : 'text-gray-300'}`}>
                            <span className="text-2xl">üè†</span>
                            <span className="text-[9px] font-bold uppercase">In√≠cio</span>
                        </button>
                        <button onClick={() => setTab('cardapio')} className={`nav-button ${tab === 'cardapio' ? 'text-emerald-500' : 'text-gray-300'}`}>
                            <span className="text-2xl">üìÖ</span>
                            <span className="text-[9px] font-bold uppercase">Plano</span>
                        </button>
                        <button onClick={() => setTab('receitas')} className={`nav-button ${tab === 'receitas' ? 'text-emerald-500' : 'text-gray-300'}`}>
                            <span className="text-2xl">ü•ò</span>
                            <span className="text-[9px] font-bold uppercase">Receitas</span>
                        </button>
                        <button onClick={() => setTab('chat')} className={`nav-button ${tab === 'chat' ? 'text-emerald-500' : 'text-gray-300'}`}>
                            <span className="text-2xl">üí¨</span>
                            <span className="text-[9px] font-bold uppercase">IA Jeey</span>
                        </button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
